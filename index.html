<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .stamp-counter {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }
        
        .stamp-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .stamp {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 3px solid #ddd;
        }
        
        .stamp.collected {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border-color: #ff6b6b;
            color: white;
            animation: bounce 0.5s ease;
        }
        
        .stamp.empty {
            background: #f8f9fa;
            color: #999;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
        
        .qr-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .qr-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .scan-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .scan-button:hover {
            transform: translateY(-2px);
        }
        
        .scan-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .or-divider {
            text-align: center;
            color: #666;
            font-size: 14px;
            position: relative;
        }
        
        .or-divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }
        
        .qr-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .qr-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .qr-button:hover {
            transform: translateY(-2px);
        }
        
        .qr-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .qr-scanner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .scanner-header {
            background: #333;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .scanner-header h4 {
            margin: 0;
            font-size: 16px;
        }
        
        .close-scanner {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-scanner:hover {
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        .qr-reader {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .scanner-info {
            background: #333;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        
        .scanner-info p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        #qrReader video {
            width: 100% !important;
            height: auto !important;
            max-height: 70vh;
            object-fit: cover;
        }
        
        #qrReader canvas {
            display: none;
        }
        
        .prize-section {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .prize-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #e17055, #fdcb6e);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .prize-button:hover {
            transform: translateY(-2px);
        }
        
        .prize-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
            <p>40ç¤¾å‚åŠ ï¼è³å“ã‚’ç‹™ãŠã†ï¼</p>
        </div>
        
        <div class="stamp-counter">
            <h2>ç²å¾—ã‚¹ã‚¿ãƒ³ãƒ—æ•°: <span id="stampCount">0</span> / 40</h2>
            <div class="stamp-display">
                <div class="stamp empty" id="stamp1">ğŸ“Œ</div>
                <div class="stamp empty" id="stamp2">ğŸ“Œ</div>
                <div class="stamp empty" id="stamp3">ğŸ“Œ</div>
            </div>
            <p>2ã¤ä»¥ä¸Šã®ã‚¹ã‚¿ãƒ³ãƒ—ã§å¿œå‹Ÿå¯èƒ½ï¼</p>
        </div>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <div class="qr-section">
            <h3>ğŸ” QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</h3>
            <p>å„åº—èˆ—ã®QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚ˆã†ï¼</p>
            
            <div class="qr-buttons">
                <button id="scanQR" class="qr-button scan-button">ğŸ“· ã‚«ãƒ¡ãƒ©ã§QRã‚¹ã‚­ãƒ£ãƒ³</button>
                <div class="or-divider">ã¾ãŸã¯</div>
                <input type="text" id="qrInput" class="qr-input" placeholder="QRã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’æ‰‹å‹•å…¥åŠ›">
                <button id="submitStamp" class="qr-button">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç²å¾—ã™ã‚‹</button>
            </div>
            
            <!-- QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ -->
            <div id="qrScanner" class="qr-scanner" style="display: none;">
                <div class="scanner-header">
                    <h4>ğŸ“· QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„</h4>
                    <button id="closeScannerBtn" class="close-scanner">Ã—</button>
                </div>
                <div id="qrReader" class="qr-reader"></div>
                <div class="scanner-info">
                    <p>QRã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€ã‚«ãƒ¡ãƒ©ã‚’è¿‘ã¥ã‘ã‚‹ã‹æ˜ã‚‹ã„å ´æ‰€ã§è©¦ã—ã¦ãã ã•ã„</p>
                </div>
            </div>
        </div>
        
        <div class="prize-section">
            <h3>ğŸ è³å“å¿œå‹Ÿ</h3>
            <p>â€¢ 2ã‚¹ã‚¿ãƒ³ãƒ—: å•†å“åˆ¸1æšãŒå½“ãŸã‚‹ï¼</p>
            <p>â€¢ 3ã‚¹ã‚¿ãƒ³ãƒ—ä»¥ä¸Š: å•†å“åˆ¸2æšãŒå½“ãŸã‚‹ï¼</p>
            <button id="applyPrize" class="prize-button" disabled>è³å“ã«å¿œå‹Ÿã™ã‚‹</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <script>
        // âš ï¸ é‡è¦: ä»¥ä¸‹ã®å€¤ã‚’å®Ÿéš›ã®å€¤ã«å¤‰æ›´ã—ã¦ãã ã•ã„ âš ï¸
        let liffId = '2008067578-By4EN4dJ';  // â† LINE Developersã§å–å¾—ã—ãŸLIFF IDã«å¤‰æ›´
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyzfjCybSCXRWj-lZsqQNDpj-Yb8bjwoNJIPLoqX7Ki01RiiYscX49oL06G2nKTQoAA/exec';  // â† GASã®Webã‚¢ãƒ—ãƒªURLã«å¤‰æ›´
        
        let userId = '';
        let currentStamps = [];
        
        // QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–¢é€£ã®å¤‰æ•°
        let html5QrCode = null;
        let isScanning = false;
        
        // LIFFåˆæœŸåŒ–
        if (typeof liff !== 'undefined') {
            liff.init({
                liffId: liffId
            }).then(() => {
                if (liff.isLoggedIn()) {
                    liff.getProfile().then(profile => {
                        userId = profile.userId;
                        loadUserData();
                    });
                } else {
                    liff.login();
                }
            }).catch(err => {
                console.error('LIFF initialization failed', err);
                showMessage('LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + err, 'error');
                // LIFFå¤±æ•—æ™‚ã‚‚ã‚¢ãƒ—ãƒªã¯å‹•ä½œã•ã›ã‚‹ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                userId = 'test_user_' + Date.now();
            });
        } else {
            console.log('LIFF not available, running in test mode');
            userId = 'test_user_' + Date.now();
        }
        
        // QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½
        document.getElementById('scanQR').addEventListener('click', function() {
            console.log('Scan button clicked');
            
            // LIFFãŒåˆ©ç”¨å¯èƒ½ã§ã‹ã¤LINEå†…ã®å ´åˆã¯ã€LIFFæ©Ÿèƒ½ã‚’å„ªå…ˆ
            if (typeof liff !== 'undefined' && liff.isInClient && liff.isApiAvailable && liff.isApiAvailable('scanCodeV2')) {
                console.log('Using LIFF scanner');
                liff.scanCodeV2()
                    .then(result => {
                        document.getElementById('qrInput').value = result.value;
                        showMessage('QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸï¼', 'success');
                        setTimeout(() => {
                            document.getElementById('submitStamp').click();
                        }, 1000);
                    })
                    .catch(error => {
                        console.error('LIFF QR scan error:', error);
                        // LIFFå¤±æ•—æ™‚ã¯HTML5ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        startHtml5QrScanner();
                    });
            } else {
                console.log('Using HTML5 scanner');
                // LINEå¤–ã¾ãŸã¯LIFFéå¯¾å¿œã®å ´åˆã¯HTML5ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‚’ä½¿ç”¨
                startHtml5QrScanner();
            }
        });
        
        // HTML5 QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–‹å§‹
        function startHtml5QrScanner() {
            if (isScanning) return;
            
            console.log('Starting HTML5 QR scanner');
            showMessage('ã‚«ãƒ¡ãƒ©ã‚’æº–å‚™ä¸­...', 'success');
            
            const qrScannerDiv = document.getElementById('qrScanner');
            qrScannerDiv.style.display = 'flex';
            
            html5QrCode = new Html5Qrcode('qrReader');
            isScanning = true;
            
            // ã‚«ãƒ¡ãƒ©è¨­å®š
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0,
                disableFlip: false
            };
            
            // ã¾ãšã‚«ãƒ¡ãƒ©ä¸€è¦§ã‚’å–å¾—
            Html5Qrcode.getCameras().then(devices => {
                console.log('Found cameras:', devices);
                
                if (devices && devices.length) {
                    showMessage(`${devices.length}å€‹ã®ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`, 'success');
                    
                    let cameraId = devices[0].id;
                    let selectedCamera = devices[0];
                    
                    // èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’æ¢ã™
                    for (let device of devices) {
                        if (device.label.toLowerCase().includes('back') || 
                            device.label.toLowerCase().includes('rear') ||
                            device.label.toLowerCase().includes('environment')) {
                            cameraId = device.id;
                            selectedCamera = device;
                            break;
                        }
                    }
                    
                    console.log('Selected camera:', selectedCamera);
                    showMessage(`ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...`, 'success');
                    
                    html5QrCode.start(
                        cameraId,
                        config,
                        (decodedText, decodedResult) => {
                            console.log('QR Code detected:', decodedText);
                            stopHtml5QrScanner();
                            document.getElementById('qrInput').value = decodedText;
                            showMessage('QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸï¼', 'success');
                            setTimeout(() => {
                                document.getElementById('submitStamp').click();
                            }, 1000);
                        },
                        (errorMessage) => {
                            // ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆé€šå¸¸ã®ã‚¹ã‚­ãƒ£ãƒ³ä¸­ã¯ç„¡è¦–ï¼‰
                        }
                    ).then(() => {
                        console.log('Camera started successfully');
                        showMessage('ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã—ã¾ã—ãŸï¼', 'success');
                    }).catch(err => {
                        console.error('Camera start error:', err);
                        let errorMsg = 'ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼: ';
                        
                        if (err.name === 'NotAllowedError') {
                            errorMsg += 'ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚';
                        } else if (err.name === 'NotFoundError') {
                            errorMsg += 'ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚';
                        } else if (err.name === 'NotReadableError') {
                            errorMsg += 'ã‚«ãƒ¡ãƒ©ãŒä½¿ç”¨ä¸­ã§ã™ã€‚';
                        } else {
                            errorMsg += err.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼';
                        }
                        
                        stopHtml5QrScanner();
                        showMessage(errorMsg, 'error');
                    });
                } else {
                    stopHtml5QrScanner();
                    showMessage('ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚', 'error');
                }
            }).catch(err => {
                console.error('Get cameras error:', err);
                stopHtml5QrScanner();
                showMessage('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            });
        }
        
        // HTML5 QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢
        function stopHtml5QrScanner() {
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    html5QrCode.clear();
                    document.getElementById('qrScanner').style.display = 'none';
                    isScanning = false;
                }).catch(err => {
                    console.error('Stop scanner error:', err);
                    document.getElementById('qrScanner').style.display = 'none';
                    isScanning = false;
                });
            } else {
                document.getElementById('qrScanner').style.display = 'none';
                isScanning = false;
            }
        }
        
        // ã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
        document.getElementById('closeScannerBtn').addEventListener('click', stopHtml5QrScanner);
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadUserData() {
            // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
            currentStamps = [];
            updateStampDisplay();
        }
        
        // ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤ºæ›´æ–°
        function updateStampDisplay() {
            const stampCount = currentStamps.length;
            document.getElementById('stampCount').textContent = stampCount;
            
            for (let i = 1; i <= 3; i++) {
                const stampElement = document.getElementById('stamp' + i);
                if (i <= stampCount) {
                    stampElement.className = 'stamp collected';
                    stampElement.textContent = 'ğŸ¯';
                } else {
                    stampElement.className = 'stamp empty';
                    stampElement.textContent = 'ğŸ“Œ';
                }
            }
            
            const applyButton = document.getElementById('applyPrize');
            if (stampCount >= 2) {
                applyButton.disabled = false;
                applyButton.textContent = `è³å“ã«å¿œå‹Ÿã™ã‚‹ (å•†å“åˆ¸${stampCount >= 3 ? '2' : '1'}æš)`;
            } else {
                applyButton.disabled = true;
                applyButton.textContent = 'è³å“ã«å¿œå‹Ÿã™ã‚‹ (ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¶³ã‚Šã¾ã›ã‚“)';
            }
        }
        
        // ã‚¹ã‚¿ãƒ³ãƒ—ç²å¾—å‡¦ç†
        document.getElementById('submitStamp').addEventListener('click', function() {
            const qrCode = document.getElementById('qrInput').value.trim();
            
            if (!qrCode) {
                showMessage('QRã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            showLoading(true);
            
            // ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªå‡¦ç†
            setTimeout(() => {
                if (qrCode.includes('STAMP_') || qrCode.length > 5) {
                    currentStamps.push({
                        companyId: qrCode,
                        companyName: 'ãƒ†ã‚¹ãƒˆåº—èˆ—',
                        timestamp: new Date()
                    });
                    updateStampDisplay();
                    showMessage('ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç²å¾—ã—ã¾ã—ãŸï¼', 'success');
                    document.getElementById('qrInput').value = '';
                } else {
                    showMessage('ç„¡åŠ¹ãªQRã‚³ãƒ¼ãƒ‰ã§ã™', 'error');
                }
                showLoading(false);
            }, 1000);
        });
        
        // è³å“å¿œå‹Ÿå‡¦ç†ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ é€£æºï¼‰
        document.getElementById('applyPrize').addEventListener('click', function() {
            if (currentStamps.length < 2) {
                showMessage('ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ˆ2ã¤ä»¥ä¸Šå¿…è¦ï¼‰', 'error');
                return;
            }
            
            if (hasApplied) {
                showMessage('æ—¢ã«å¿œå‹Ÿæ¸ˆã¿ã§ã™', 'error');
                return;
            }
            
            // Googleãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æº–å‚™
            const stampCount = currentStamps.length;
            const prizeType = stampCount >= 3 ? 'å•†å“åˆ¸2æš' : 'å•†å“åˆ¸1æš';
            const stampList = currentStamps.map(s => s.companyId).join(', ');
            
            // Googleãƒ•ã‚©ãƒ¼ãƒ ã®URLï¼ˆè¦å¤‰æ›´ï¼‰
            const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfJpTuEes6OqoDVIJqhdLjSfAJey3560soOPblBinPecUivDQ/viewform';
            
            // Googleãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰IDã‚’è¨­å®šï¼‰
            const formParams = new URLSearchParams({
                // ä»¥ä¸‹ã¯ä¾‹ã§ã™ã€‚å®Ÿéš›ã®Googleãƒ•ã‚©ãƒ¼ãƒ ã®field IDã«å¤‰æ›´ã—ã¦ãã ã•ã„
                'entry.123456789': userId,           // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
                'entry.987654321': stampCount,       // ã‚¹ã‚¿ãƒ³ãƒ—æ•°
                'entry.111111111': prizeType,        // è³å“ç¨®é¡
                'entry.222222222': stampList,        // ç²å¾—ã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§
                'entry.333333333': new Date().toISOString() // å¿œå‹Ÿæ—¥æ™‚
            });
            
            const fullFormUrl = `${GOOGLE_FORM_URL}?${formParams.toString()}`;
            
            // å¿œå‹ŸçŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‰ã«å®Ÿè¡Œï¼‰
            hasApplied = true;
            updateStampDisplay();
            
            // Googleãƒ•ã‚©ãƒ¼ãƒ ã‚’æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã
            if (typeof liff !== 'undefined' && liff.isInClient) {
                // LINEå†…ã®å ´åˆã¯å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
                liff.openWindow({
                    url: fullFormUrl,
                    external: true
                });
            } else {
                // é€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®å ´åˆ
                window.open(fullFormUrl, '_blank');
            }
            
            showMessage('Googleãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ãã¾ã—ãŸã€‚å¿…è¦äº‹é …ã‚’å…¥åŠ›ã—ã¦å¿œå‹Ÿã—ã¦ãã ã•ã„ï¼', 'success');
        });
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.className = `message ${type}`;
            messageElement.style.display = 'block';
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        console.log('App loaded successfully');
    </script>
</body>
</html>
